<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <title>Example</title>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <style>
        #result {
            max-width: 100%;
        }
    </style>
    <script>

        function upload() {
            var file = document.querySelector('input[name="file"]');
            var res = document.querySelector("#result");
            res.innerHTML="";
            put("/xls", {
                files: file
            }).then(function(data){
                console.log(data);
                res.innerHTML = JSON.stringify(data);
            }).catch(function(err){
                console.error(err);
            });
        }

        function put(url, data) {
            return new Promise(function (resolve, reject) {
                if (data.files === undefined) {
                    reject("Upload error: no files");
                }
                if (FormData === undefined) {
                    reject("Upload error: no FormData");
                }
                if (url === undefined) {
                    reject("Upload error: no url");
                }
                var fd = new FormData();
                var i;

                for (i = 0; i < data.files.files.length; i++) {
                    fd.append('files[]', data.files.files[i]);
                }
                fd.append('ajax', true);
                var rq = new XMLHttpRequest();
                rq.upload.addEventListener('progress', function (e) {
                    if (e.lengthComputable) {
                        var perc = Math.round((e.loaded / e.total) * 100) + " %";
                        console.log("upload progress:", perc);
                    }
                });
                rq.upload.addEventListener('load', function () {
                    console.log('upload progress: done');
                });
                rq.upload.addEventListener('error', function (e) {
                    reject('upload error: ' + e);
                });
                rq.addEventListener('readystatechange', function () {
                    if (this.readyState === 4) {
                        if (this.status === 200) {
                            var ret = this.responseText;
                            if (this.getResponseHeader('Content-Type') !== null) {
                                if (this.getResponseHeader('Content-Type').indexOf('application/json') > -1) {
                                    ret = JSON.parse(ret);
                                }
                            }
                            resolve(ret);
                        } else {
                            reject('Upload error: ' + this.statusText);
                        }
                    }
                });
                rq.open('PUT', url);
                if (data.headers !== undefined) {
                    var h;
                    for (h in data.headers) {
                        if (data.headers.hasOwnProperty(h)) {
                            rq.setRequestHeader(h, data.headers[h]);
                        }
                    }
                }
                rq.send(fd);
            });
        };
    </script>
</head>

<body>
    <h1>Example</h1>
    <input type="file" name="file" multiple />
    <button onclick="upload()">Upload</button>
    <div id="result"></div>
</body>

</html>